<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" 
        content="default-src 'self'; 
                 script-src 'self' 'unsafe-inline'; 
                 style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
                 font-src 'self' https://fonts.gstatic.com;">
  <title>VAULT 4624 - Query Converter</title>
  <link href="https://fonts.googleapis.com/css?family=VT323&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
  <style>
    .converter-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 30px 0;
    }

    .query-panel {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--dim-color);
      padding: 20px;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--dim-color);
    }

    .siem-selector {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--main-color);
      color: var(--main-color);
      padding: 8px 12px;
      font-family: 'VT323', monospace;
      font-size: 1.1em;
      cursor: pointer;
    }

    .siem-selector:focus {
      outline: none;
      box-shadow: 0 0 10px rgba(74, 250, 154, 0.3);
    }

    .query-input {
      width: 100%;
      min-height: 200px;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--dim-color);
      color: var(--main-color);
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 0.95em;
      resize: vertical;
    }

    .query-input:focus {
      outline: none;
      border-color: var(--main-color);
    }

    .query-output {
      width: 100%;
      min-height: 200px;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--main-color);
      color: var(--main-color);
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 0.95em;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .btn-action {
      padding: 10px 20px;
      background: var(--main-color);
      color: var(--bg-color);
      border: none;
      cursor: pointer;
      font-family: 'VT323', monospace;
      font-size: 1.1em;
      transition: all 0.3s;
    }

    .btn-action:hover {
      background: var(--warning);
      box-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
    }

    .btn-secondary {
      background: rgba(74, 250, 154, 0.2);
      color: var(--main-color);
      border: 1px solid var(--main-color);
    }

    .btn-secondary:hover {
      background: rgba(74, 250, 154, 0.3);
    }

    .examples-section {
      margin: 40px 0;
    }

    .example-card {
      background: rgba(74, 250, 154, 0.05);
      border: 1px solid var(--dim-color);
      padding: 20px;
      margin-bottom: 20px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .example-card:hover {
      border-color: var(--main-color);
      background: rgba(74, 250, 154, 0.1);
    }

    .example-title {
      color: var(--main-color);
      font-size: 1.2em;
      margin-bottom: 10px;
    }

    .example-desc {
      color: var(--dim-color);
      font-size: 0.9em;
      margin-bottom: 10px;
    }

    .example-preview {
      background: rgba(0, 0, 0, 0.5);
      padding: 10px;
      font-family: 'Courier New', monospace;
      font-size: 0.85em;
      color: var(--dim-color);
      border-left: 2px solid var(--main-color);
      margin-top: 10px;
      overflow-x: auto;
    }

    .info-box {
      background: rgba(255, 204, 0, 0.1);
      border-left: 3px solid var(--warning);
      padding: 15px;
      margin: 20px 0;
      color: var(--dim-color);
    }

    .field-mapping {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 20px 0;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    .field-item {
      background: rgba(0, 0, 0, 0.3);
      padding: 8px;
      border-left: 2px solid var(--dim-color);
    }

    @media (max-width: 968px) {
      .converter-layout {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="scanline"></div>
  <div class="overlay"></div>

  <nav class="main-nav">
    <div class="nav-brand">VAULT_4624<span class="cursor"></span></div>
    <div class="nav-links">
      <a href="../index.html#intelligence" class="nav-link"><span class="prompt">&gt;</span> INTELLIGENCE</a>
      <a href="../index.html#resources" class="nav-link"><span class="prompt">&gt;</span> RESOURCES</a>
    </div>
  </nav>

  <section class="hero">
    <h1>SIEM QUERY CONVERTER</h1>
    <p class="subtitle">Translate detection queries between different SIEM platforms</p>
    <div class="status-bar">
      <div class="status-item">
        <span class="status-indicator success"></span>
        SPLUNK | SENTINEL | ELASTIC
      </div>
      <div class="status-item">
        <span class="status-indicator warning"></span>
        PATTERN LIBRARY
      </div>
      <div class="status-item">
        <span class="status-indicator success"></span>
        SIDE-BY-SIDE
      </div>
    </div>
  </section>

  <div class="content-wrapper">
    
    <div class="info-box">
      <strong>⚠️ REALITY CHECK:</strong> This converter handles common hunting patterns, not advanced queries. 
      Think of it as a translation guide + template library. Field names may need tweaking for your environment. 
      Always test queries before using in production!
    </div>

    <div class="converter-layout">
      <!-- Input Panel -->
      <div class="query-panel">
        <div class="panel-header">
          <h3>SOURCE QUERY</h3>
          <select class="siem-selector" id="source-siem">
            <option value="splunk">Splunk SPL</option>
            <option value="kql">Sentinel KQL</option>
            <option value="lucene">Elastic Lucene</option>
          </select>
        </div>
        <textarea 
          class="query-input" 
          id="input-query" 
          placeholder="Paste your query here or select an example below..."
        ></textarea>
        <div class="action-buttons">
          <button class="btn-action" onclick="convertQuery()">CONVERT &gt;&gt;</button>
          <button class="btn-action btn-secondary" onclick="clearAll()">CLEAR</button>
        </div>
      </div>

      <!-- Output Panel -->
      <div class="query-panel">
        <div class="panel-header">
          <h3>CONVERTED QUERY</h3>
          <select class="siem-selector" id="target-siem">
            <option value="kql">Sentinel KQL</option>
            <option value="splunk">Splunk SPL</option>
            <option value="lucene">Elastic Lucene</option>
          </select>
        </div>
        <div class="query-output" id="output-query">
          // Converted query will appear here...
        </div>
        <div class="action-buttons">
          <button class="btn-action" onclick="copyOutput()">COPY</button>
          <button class="btn-action btn-secondary" onclick="swapSIEMs()">SWAP SIEMS</button>
        </div>
      </div>
    </div>

    <!-- Common Field Mappings -->
    <section>
      <h2 class="section-header">
        <span class="prompt">&gt;&gt;</span> COMMON FIELD MAPPINGS
      </h2>
      <div class="field-mapping" id="field-mappings">
        <!-- Populated by JS -->
      </div>
    </section>

    <!-- Example Queries -->
    <section class="examples-section">
      <h2 class="section-header">
        <span class="prompt">&gt;&gt;</span> EXAMPLE HUNT QUERIES
      </h2>

      <div class="example-card" onclick="loadExample('process-creation')">
        <div class="example-title">Suspicious Process Creation</div>
        <div class="example-desc">
          Detect execution of PowerShell with encoded commands or suspicious parent processes
        </div>
        <div class="example-preview">
          Splunk: index=windows EventCode=4688 | search CommandLine="*-enc*" OR CommandLine="*-encodedcommand*"
        </div>
      </div>

      <div class="example-card" onclick="loadExample('network-beacon')">
        <div class="example-title">C2 Beaconing Detection</div>
        <div class="example-desc">
          Identify regular network connections that might indicate command & control communication
        </div>
        <div class="example-preview">
          KQL: NetworkConnectionEvents | summarize count() by RemoteIP, bin(TimeGenerated, 1h)
        </div>
      </div>

      <div class="example-card" onclick="loadExample('failed-logons')">
        <div class="example-title">Failed Login Attempts</div>
        <div class="example-desc">
          Track failed authentication attempts that might indicate brute force attacks
        </div>
        <div class="example-preview">
          Splunk: index=windows EventCode=4625 | stats count by src_ip, user | where count > 10
        </div>
      </div>

      <div class="example-card" onclick="loadExample('registry-persistence')">
        <div class="example-title">Registry Persistence</div>
        <div class="example-desc">
          Monitor common registry locations used for persistence mechanisms
        </div>
        <div class="example-preview">
          KQL: RegistryEvents | where RegistryKey contains "Run" or RegistryKey contains "RunOnce"
        </div>
      </div>

      <div class="example-card" onclick="loadExample('lateral-movement')">
        <div class="example-title">Lateral Movement via RDP</div>
        <div class="example-desc">
          Detect Remote Desktop connections that might indicate lateral movement
        </div>
        <div class="example-preview">
          Elastic: event.code:4624 AND winlog.logon.type:10
        </div>
      </div>

      <div class="example-card" onclick="loadExample('file-creation')">
        <div class="example-title">Suspicious File Creation</div>
        <div class="example-desc">
          Monitor file creation in unusual locations (temp directories, startup folders)
        </div>
        <div class="example-preview">
          Splunk: index=sysmon EventCode=11 | search TargetFilename="*\\Temp\\*" OR TargetFilename="*\\Startup\\*"
        </div>
      </div>
    </section>

  </div>

  <footer class="footer">
    <div class="footer-content">
      <p>&gt;&gt; VAULT 4624 QUERY CONVERTER</p>
      <p>Translation guide for common SIEM hunting patterns</p>
      <p style="margin-top: 10px;"><a href="../index.html" style="color: var(--dim-color);">← Return to Terminal</a></p>
    </div>
  </footer>

  <script src="../js/utils.js"></script>
  <script>
    // Field mapping reference between SIEMs
    const fieldMappings = {
      splunk: {
        process: 'process',
        command: 'CommandLine',
        user: 'user',
        src_ip: 'src_ip',
        dest_ip: 'dest_ip',
        dest_port: 'dest_port',
        event_id: 'EventCode',
        registry_key: 'registry_path'
      },
      kql: {
        process: 'ProcessCommandLine',
        command: 'ProcessCommandLine',
        user: 'AccountName',
        src_ip: 'SourceIP',
        dest_ip: 'DestinationIP',
        dest_port: 'DestinationPort',
        event_id: 'EventID',
        registry_key: 'RegistryKey'
      },
      lucene: {
        process: 'process.name',
        command: 'process.command_line',
        user: 'user.name',
        src_ip: 'source.ip',
        dest_ip: 'destination.ip',
        dest_port: 'destination.port',
        event_id: 'event.code',
        registry_key: 'registry.path'
      }
    };

    // Example queries library
    const examples = {
      'process-creation': {
        splunk: 'index=windows EventCode=4688\n| search CommandLine="*-enc*" OR CommandLine="*-encodedcommand*" OR CommandLine="*invoke-expression*"\n| table _time, host, user, process, CommandLine\n| sort -_time',
        kql: 'SecurityEvent\n| where EventID == 4688\n| where ProcessCommandLine contains "-enc" or ProcessCommandLine contains "-encodedcommand" or ProcessCommandLine contains "invoke-expression"\n| project TimeGenerated, Computer, Account, NewProcessName, ProcessCommandLine\n| order by TimeGenerated desc',
        lucene: 'event.code:4688 AND (process.command_line:*-enc* OR process.command_line:*encodedcommand* OR process.command_line:*invoke-expression*)'
      },
      'network-beacon': {
        splunk: 'index=network sourcetype=firewall\n| bucket _time span=1h\n| stats count by _time, dest_ip, dest_port\n| where count > 10\n| table _time, dest_ip, dest_port, count',
        kql: 'NetworkConnectionEvents\n| summarize ConnectionCount = count() by RemoteIP, RemotePort, bin(TimeGenerated, 1h)\n| where ConnectionCount > 10\n| order by ConnectionCount desc',
        lucene: 'event.category:network\n| groupby destination.ip,destination.port,@timestamp(1h)\n| having count > 10'
      },
      'failed-logons': {
        splunk: 'index=windows EventCode=4625\n| stats count by src_ip, user\n| where count > 10\n| sort -count\n| table src_ip, user, count',
        kql: 'SecurityEvent\n| where EventID == 4625\n| summarize FailedAttempts = count() by IpAddress, TargetUserName\n| where FailedAttempts > 10\n| order by FailedAttempts desc',
        lucene: 'event.code:4625\n| groupby source.ip,user.name\n| having count > 10'
      },
      'registry-persistence': {
        splunk: 'index=sysmon EventCode=13\n| search registry_path="*\\\\CurrentVersion\\\\Run*" OR registry_path="*\\\\CurrentVersion\\\\RunOnce*"\n| table _time, host, user, registry_path, registry_value_data',
        kql: 'RegistryEvents\n| where ActionType == "RegistryValueSet"\n| where RegistryKey contains "\\\\Run" or RegistryKey contains "\\\\RunOnce"\n| project TimeGenerated, DeviceName, InitiatingProcessAccountName, RegistryKey, RegistryValueData',
        lucene: 'event.code:13 AND (registry.path:*\\\\Run* OR registry.path:*\\\\RunOnce*)'
      },
      'lateral-movement': {
        splunk: 'index=windows EventCode=4624 Logon_Type=10\n| stats count by src_ip, dest_host, user\n| table src_ip, dest_host, user, count',
        kql: 'SecurityEvent\n| where EventID == 4624 and LogonType == 10\n| summarize count() by IpAddress, Computer, TargetUserName\n| project IpAddress, Computer, TargetUserName, count_',
        lucene: 'event.code:4624 AND winlog.logon.type:10'
      },
      'file-creation': {
        splunk: 'index=sysmon EventCode=11\n| search TargetFilename="*\\\\Temp\\\\*.exe" OR TargetFilename="*\\\\AppData\\\\*" OR TargetFilename="*\\\\Startup\\\\*"\n| table _time, host, user, Image, TargetFilename',
        kql: 'DeviceFileEvents\n| where ActionType == "FileCreated"\n| where FolderPath contains "\\\\Temp\\\\" or FolderPath contains "\\\\AppData\\\\" or FolderPath contains "\\\\Startup\\\\"\n| where FileName endswith ".exe"\n| project TimeGenerated, DeviceName, InitiatingProcessAccountName, FileName, FolderPath',
        lucene: 'event.code:11 AND (file.path:*\\\\Temp\\\\*.exe OR file.path:*\\\\AppData\\\\* OR file.path:*\\\\Startup\\\\*)'
      }
    };

    // Initialize field mappings display
    function displayFieldMappings() {
      const source = document.getElementById('source-siem').value;
      const target = document.getElementById('target-siem').value;
      const container = document.getElementById('field-mappings');
      
      const sourceFields = fieldMappings[source];
      const targetFields = fieldMappings[target];
      
      let html = '';
      for (let field in sourceFields) {
        html += `
          <div class="field-item">
            <strong>${source.toUpperCase()}:</strong> ${sourceFields[field]}
          </div>
          <div class="field-item">
            <strong>${target.toUpperCase()}:</strong> ${targetFields[field]}
          </div>
        `;
      }
      
      container.innerHTML = html;
    }

    // Simple pattern-based conversion (not perfect, but practical)
    function convertQuery() {
      const source = document.getElementById('source-siem').value;
      const target = document.getElementById('target-siem').value;
      const input = document.getElementById('input-query').value.trim();
      
      if (!input) {
        document.getElementById('output-query').textContent = '// No input query provided';
        return;
      }

      if (source === target) {
        document.getElementById('output-query').textContent = '// Source and target SIEM are the same!\n\n' + input;
        return;
      }

      let converted = input;
      const sourceMap = fieldMappings[source];
      const targetMap = fieldMappings[target];

      // Basic field replacement
      for (let field in sourceMap) {
        const sourceField = sourceMap[field];
        const targetField = targetMap[field];
        // Use word boundaries to avoid partial matches
        const regex = new RegExp('\\b' + escapeRegex(sourceField) + '\\b', 'g');
        converted = converted.replace(regex, targetField);
      }

      // Add conversion notes
      const notes = `// Converted from ${source.toUpperCase()} to ${target.toUpperCase()}\n// NOTE: This is a basic conversion. Please verify:\n//   - Field names match your data source\n//   - Syntax is correct for your version\n//   - Logic is preserved correctly\n\n`;
      
      document.getElementById('output-query').textContent = notes + converted;
    }

    function escapeRegex(str) {
      return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    function loadExample(exampleId) {
      const source = document.getElementById('source-siem').value;
      const example = examples[exampleId];
      
      if (example && example[source]) {
        document.getElementById('input-query').value = example[source];
        convertQuery();
      }
    }

    function copyOutput() {
      const output = document.getElementById('output-query').textContent;
      navigator.clipboard.writeText(output).then(() => {
        const btn = event.target;
        btn.textContent = 'COPIED!';
        btn.style.background = 'var(--warning)';
        setTimeout(() => {
          btn.textContent = 'COPY';
          btn.style.background = 'var(--main-color)';
        }, 2000);
      });
    }

    function clearAll() {
      document.getElementById('input-query').value = '';
      document.getElementById('output-query').textContent = '// Converted query will appear here...';
    }

    function swapSIEMs() {
      const source = document.getElementById('source-siem');
      const target = document.getElementById('target-siem');
      const temp = source.value;
      source.value = target.value;
      target.value = temp;
      displayFieldMappings();
    }

    // Update field mappings when SIEM selection changes
    document.getElementById('source-siem').addEventListener('change', displayFieldMappings);
    document.getElementById('target-siem').addEventListener('change', displayFieldMappings);

    // Initialize on load
    displayFieldMappings();
  </script>
</body>
</html>
